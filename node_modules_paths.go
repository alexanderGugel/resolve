package resolve

import (
	"os"
	"strings"
)

func nodeModulesPaths(start string) []string {
	// NODE_MODULES_PATHS(START)
	// 1. let PARTS = path split(START)
	// 2. let ROOT = index of first instance of NodeModules in PARTS, or 0
	// 3. let I = count of PARTS - 1
	// 4. let DIRS = []
	// 5. while I > ROOT,
	//    a. if PARTS[I] = NodeModules CONTINUE
	//    c. DIR = path join(PARTS[0 .. I] + NodeModules)
	//    b. DIRS = DIRS + DIR
	//    c. let I = I - 1
	// 6. return DIRS

	parts := strings.Split(start, string(os.PathSeparator))

	root := 0

	for index, part := range parts {
		if part == NodeModules {
			root = index
			break
		}
	}

	dirs := []string{}

	for i := len(parts) - 1; i > root ; i-- {
		if parts[i] == NodeModules {
			continue
		}

		dir := strings.Join(append(parts[0:i-1], NodeModules), string(os.PathSeparator))

		dirs = append(dirs, dir)
	}

	return dirs
}
